---

.retry:
  retry:
    max: 2
    when:
      - runner_system_failure
      - stuck_or_timeout_failure

.ci-image-pull-boilerplate:
  extends:
    - .retry
  image: "${CI_IMAGE}"

.ci-image-based-job-boilerplate:
  extends:
    - .ci-image-pull-boilerplate
  needs: ["pull:docker-image"]
  before_script:
    - pip install tox

variables:
  CI_REGISTRY_IMAGE: "${DOCKER_NAMESPACE}/${CI_PROJECT_NAME}"
  # yamllint disable-line rule:line-length
  DOCKERFILE_FILENAME: "pyenv-python-3.7.9-3.8.6-3.9.0-poetry-hadolint-go-1.15.5"
  # yamllint disable-line rule:line-length
  CI_IMAGE: "${DOCKER_NAMESPACE}/${CI_PROJECT_NAME}:${DOCKERFILE_FILENAME}_${CI_COMMIT_SHORT_SHA}"
